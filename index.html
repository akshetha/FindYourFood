<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FoodMap</title>
<style>
 html,body { height:100%; margin:0; font-family:system-ui, sans-serif; background:#562323; color:#4a1d1d; }
 .stage {
   width:100%; height:100vh; display:flex; flex-direction:row; align-items:center; justify-content:center; gap:12px; padding:12px; box-sizing:border-box;
 }

 /* POPUP */
 .pop{
  background:white;
  opacity:0;
  position:fixed;
  width:600px;
  height:500px;
  transition:all .2s ease-in-out;
  z-index:-1;
  display:flex;
  align-items:baseline;
  justify-content:center;
 }
 .pop.open{ opacity:1; z-index:999; }

 .pop .modal-inner{
   display:flex;
   flex-direction:column;
   align-items:center;
   gap:12px;
   width:100%;
   box-sizing:border-box;
 }
 .pop input, .pop ul{
   width:90%; max-height:200px; overflow-y:auto; padding-left:20px; margin:0;
 }

 .viewport {
   width:900px; height:800px; max-width:calc(100% - 200px);
   background:#471212;
   overflow:hidden;
   border-radius:20px;
   position:relative;
   touch-action:none;
 }

 .map-container{
   position:absolute;
   top:0; left:0;
   transform-origin:0 0;
 }

 .map-img{
   position:absolute;
   top:0; left:0;
   user-select:none;
   -webkit-user-drag:none;
 }

 .marker{
   position:absolute;
   transform:translate(-50%, -50%);
   background:rgb(177,78,104);
   color:white;
   border:none;
   padding:6px 10px;
   border-radius:6px;
   font-size:16px;
   cursor:pointer;
   white-space:nowrap;
 }
 .marker:hover{ background:rgb(140,22,81); }

 #closeModal{
   background:rgb(177,78,104);
   color:white;
   border:none;
   padding:6px 12px;
   border-radius:4px;
   cursor:pointer;
 }





</style>
</head>
<body>
<div class="stage">

<div class="viewport" id="viewport">
    <div class="map-container" id="mapContainer">
        <img id="map" class="map-img" src="map.png" draggable="false">
    </div>
    <button class="marker" data-hall="ventanas" data-x="0.30" data-y="0.2">VENTANAS</button>
    <button class="marker" data-hall="pines" data-x="0.30" data-y="0.48">PINES</button>
    <button class="marker" data-hall="roots" data-x="0.30" data-y="0.50">ROOTS</button>
    <button class="marker" data-hall="canyon" data-x="0.70" data-y="0.30">CANYON VISTA</button>
    <button class="marker" data-hall="sixfour" data-x="0.30" data-y="0.75">64°</button>
    <button class="marker" data-hall="sixth" data-x="0.30" data-y="0.40">SIXTH</button>
    <button class="marker" data-hall="bistro" data-x="0.30" data-y="0.1">BISTRO</button>
    <button class="marker" data-hall="ocean" data-x="0.40" data-y="0.35">OCEAN</button>
</div>

<div class="pop" id="pop">
  <div class="modal-inner">
    <h1 id="modal-title">Rating</h1>
    <h2>-------------------------------</h2>
    <input type="text" id="menu" />
    <button id="add">Rate Items</button>
    <button id="closeModal">Close</button>
    <ul id="list"></ul>
  </div>
</div>

</div>

<script>




(() => {
  let currentHall = null;
  const STORAGE_KEY = "HALL_DATA";

  const markers = document.querySelectorAll('.marker');
  const pop = document.getElementById('pop');
  const modalTitle = document.getElementById('modal-title');
  const closeBtn = document.getElementById('closeModal');
  const list = document.getElementById('list');
  const menu = document.getElementById('menu');
  const add = document.getElementById('add');

  function loadHall(hall){
    const norm = localStorage.getItem(STORAGE_KEY + hall);
    if(!norm) return [];
    try { return JSON.parse(norm); } catch { return []; }
  }
  function saveHall(hall,data){
    localStorage.setItem(STORAGE_KEY + hall, JSON.stringify(data));
  }



  //list
  function renderList(){
    list.innerHTML = "";
    const data = loadHall(currentHall);
    data.sort((a, b) => {
      if (a.rating === 0 && b.rating !== 0) return -1; 
      if (a.rating !== 0 && b.rating === 0) return 1;
      return b.rating - a.rating;
   });

    data.forEach(item =>{
      const li = document.createElement('li');
      li.textContent = `${item.name} — ${item.rating}★ `;

      const starContainer = document.createElement('div');
      starContainer.style.display = "inline-block";
      starContainer.style.marginLeft = "10px";

    for (let i = 1; i <= 5; i++) {
      const star = document.createElement('span');
      star.textContent = i <= item.rating ? "★" : "☆";
      star.style.cursor = "pointer";
      star.style.fontSize = "22px";
      star.style.color = "maroon";


      star.addEventListener('click', () => {
      item.rating = i;
      saveHall(currentHall, data);
      renderList();
      });

      starContainer.appendChild(star);
    }

      li.appendChild(starContainer);
      list.appendChild(li);
    });
  }


  //markers
  markers.forEach(m =>{
    m.addEventListener('click',()=>{
      currentHall = m.dataset.hall;
      modalTitle.textContent = `Rating: ${m.textContent}`;
      pop.classList.add('open');
      renderList();
    });
  });
  closeBtn.addEventListener('click',()=> pop.classList.remove('open'));
  add.addEventListener('click',()=>{
    const name = menu.value.trim();
    if(!name) return;
    const data = loadHall(currentHall);
    data.push({name, rating:0});
    saveHall(currentHall,data);
    menu.value="";
    renderList();
  });




  //map
  const vp = document.getElementById('viewport');
  const map = document.getElementById('map');
  const container = document.getElementById('mapContainer');
  const markerEls = document.querySelectorAll('.marker');

  let scale = 1;
  let minScale = 0.2;
  let maxScale = 6;
  let translate = {x:0,y:0};
  let isDragging = false;
  let dragStart = {x:0,y:0};
  let translateStart = {x:0,y:0};

  function fitToView(){
    const iw = map.naturalWidth;
    const ih = map.naturalHeight;
    const vw = vp.clientWidth;
    const vh = vp.clientHeight;
    const s = Math.min(vw/iw, vh/ih);
    scale = s;

    const dispW = iw*s, dispH = ih*s;
    translate.x = Math.max(0,(vw-dispW)/2);
    translate.y = Math.max(0,(vh-dispH)/2);
    update();
  }

  function update(){
    container.style.transform = `translate(${translate.x}px, ${translate.y}px) scale(${scale})`;
    positionMarkers();
  }

  function positionMarkers(){
    const iw = map.naturalWidth;
    const ih = map.naturalHeight;

    markerEls.forEach(m =>{
      const xPct = parseFloat(m.dataset.x);
      const yPct = parseFloat(m.dataset.y);

      const scaledX = xPct * iw * scale + translate.x;
      const scaledY = yPct * ih * scale + translate.y;

      m.style.left = scaledX + 'px';
      m.style.top = scaledY + 'px';
    });
  }

  map.addEventListener('load',()=>{
    fitToView();
    update();
  });




  vp.addEventListener('mousedown',(e)=>{
    isDragging=true;
    dragStart={x:e.clientX,y:e.clientY};
    translateStart={...translate};
  });
  window.addEventListener('mousemove',(e)=>{
    if(!isDragging) return;
    translate.x = translateStart.x + (e.clientX-dragStart.x);
    translate.y = translateStart.y + (e.clientY-dragStart.y);
    update();
  });
  window.addEventListener('mouseup',()=> isDragging=false);

  vp.addEventListener('wheel',(e)=>{
    e.preventDefault();
    const delta = -e.deltaY;
    const factor = delta>0 ? 1.08 : 1/1.08;
    zoomAt(factor, e.clientX, e.clientY);
  }, {passive:false});

  function zoomAt(factor,cx,cy){
    const newScale = Math.max(minScale, Math.min(maxScale, scale*factor));
    const rect = vp.getBoundingClientRect();

    const x = (cx - rect.left - translate.x) / scale;
    const y = (cy - rect.top - translate.y) / scale;

    translate.x = cx - rect.left - x * newScale;
    translate.y = cy - rect.top - y * newScale;

    scale = newScale;
    update();
  }
})();
</script>
</body>
</html>
