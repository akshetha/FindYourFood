<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FoodMap</title>
<style>
 html,body { height:100%; margin:0; font-family:system-ui, sans-serif; background:#562323; color:#4a1d1d; }
 .stage {
   width:100%;
   height:100vh;
   display:flex;
   align-items:center;
   justify-content:center;
   gap:12px;
   padding:12px;
   box-sizing:border-box;
 }

 /* button section here for general button layout*/
 .stage .btn{
   position: fixed; /* changed this to fixed so we can move each individual button, abs keeps it all the same */
   right: 10px; /* same, originally 60 */
   transform: translate(-40%, -20%);
   -ms-transform: translate(-50%,-50%);
   transform: translateX(-60px);
   background-color: rgb(177, 78, 104);
   color: white;
   border: none;
   padding: 10px 10px; /* box size */
   text-align: center;
   font-size: 20px; 
   border-radius: 5px;
   cursor: pointer;
   width: 180px;
   /* width: 200px; */
 }

 /* button hover colors */
.stage .btn:hover {
 background-color: rgb(140, 22, 81);
 color: white;
}
/* popup window below*/
.pop{
  background-color: white;
  opacity: 0;
  position: fixed;
  /* top: 0;
  left: 0;
  right: 0;
  bottom: 0; */
  width: 600px;
  height: 500px;
  transition: all 0.3s ease-in-out;
  z-index: -1;

  display:flex;
  align-items: baseline;
  justify-content: center;
}

.pop .modal-inner {
  display: flex;
  flex-direction: column; 
  align-items: center;
  gap: 12px;
  width: 100%;
  box-sizing: border-box;
}

.pop input,
.pop ul {
  width: 90%;
  max-height: 200px;
  overflow-y: auto;
  padding-left: 20px;
  margin: 0;
  box-sizing: border-box;
}

.pop.open {
  opacity: 1;
  z-index: 999;
}

#saveResponse.btn{
  top: 130px;
  right: 540px;
}

#closeModal.btn{
  top: 130px;
  right: 870px;
}

/* .btn-img {
  width: 50px;
  height: 10px;
  border-radius: 10px;
  transition: transform 0.2s ease; 
} */

/* .btn-img:hover {
  transform: scale(1.1);
} */
#ventanas.btn{
  top: 180px;
  /* transform: translateX(-50px); */
}
#roots.btn{
  top: 260px;
  /* transform: translateX(-68px); */
}
#pines.btn {
  top: 340px;
  /* transform: translateX(-70px); */
   /* we could individualize padding and right*/
  /* this can center boxes on screen */
}
#sixfour.btn {
  top: 420px;
  /* transform: translateX(-85px); */
}
#canyon.btn {
  top: 500px;
  /* transform: translateX(-30px); */
}
#sixth.btn{
  top: 580px;
}
#bistro.btn {
  top: 660px;
  /* transform: translateX(-60px); */
}
#ocean.btn {
  top: 740px;
  /* transform: translateX(-43px); */
}

 /* size of the box that has the image inside */
 .viewport {
   width: 900px;
   height: 800px;
   max-width: calc(100% - 200px);
   background: #471212; /* color of box */
   overflow: hidden; /* so that the box doesn't take over the world */
   border-radius: 20px; /* curviness of edges */
   position:relative;
   touch-action: none; /* eeehh technically pinch-zoom but my comp isnt recognizing it and this works so idk */
 }

 /* pan-zoom */
 .img {
   position:absolute;
   top:0;
   left:0;
   user-select:none;
   -webkit-user-drag:none;
   will-change: transform;
   transform-origin: 0 0; /* where the image comes from */
   cursor: grab;
 }
 .img.dragging {cursor: grabbing;}
 .controls {
   display:flex;
   flex-direction:column;
   gap:8px;
   min-width:160px;
 }
 /* END OF CSS */
</style>
</head>
<body>
<div class="stage">
  <!-- <button id = "pines" class = "btn">
  <img src="pines.png" alt="PINES" class="btn-img"> if we want make our button go over an image
</button> -->
<button id = "ventanas" class = "btn">VENTANAS</button>
<button id = "pines" class = "btn"> PINES </button>
<button id = "roots" class = "btn">ROOTS</button>
<button id = "canyon" class = "btn">CANYON VISTA</button>
<button id = "sixfour" class = "btn">64 DEGREES</button>
<button id = "sixth" class = "btn">SIXTH COLLEGE</button>
<button id = "bistro" class = "btn">BISTRO</button>
<button id = "ocean" class = "btn">OCEAN VIEW</button>

<div class = "pop" id="pop">
  <div class = "modal-inner">
    <h1>Rating </h1>
    <h2>-------------------------------</h2>
    <button id = "closeModal" class = "btn">x</button>
      <input type = "text" name = "menu" id = "menu">
    <button id = "add">Rate Items</button>
    <ul id = "list"></ul>
  </div>
</div>

 <div class="viewport" id="viewport">
      <img id="map" class="img" src="map.jpeg" draggable="false"> <!-- map's name -->
 </div>
</div>


<script>
(() => {
  //click on button to open popup
(() => {
  let currentHall = null;
  const STORAGE_KEY = "HALL_DATA"

  const buttons = document.querySelectorAll(".btn");
  const pop = document.getElementById("pop");
  const closeBtn = document.getElementById("closeModal");
  const modalTitle = pop.querySelector("h1");
  const list = document.getElementById('list');
  const menu = document.getElementById('menu');
  const add = document.getElementById('add');
  const mostLiked = document.getElementById('mostLiked');

  //LIST FEATURE
  function loadHall(hall){
    const norm = localStorage.getItem(STORAGE_KEY + hall);
    if (!norm) return [];
    try { 
      return JSON.parse(norm); 
    } 
    catch { 
      return []; 
    }
  }

  function saveHall(hall, data) {
    localStorage.setItem(STORAGE_KEY + hall, JSON.stringify(data));
  }

  function renderList() {
  list.innerHTML = "";
  const data = loadHall(currentHall);

  data.sort((a, b) => {
    if (a.rating === 0 && b.rating !== 0) return -1; 
    if (a.rating !== 0 && b.rating === 0) return 1;
    return b.rating - a.rating;
  });

  data.forEach(item => {
  const li = document.createElement('li');
  li.textContent = `${item.name} — ${item.rating}★`;

  //ADD STAR
  const starContainer = document.createElement('div');
  starContainer.style.display = "inline-block";
  starContainer.style.marginLeft = "10px";


  for (let i = 1; i <= 5; i++) {
    const star = document.createElement('span');
    star.textContent = i <= item.rating ? "★" : "☆";
    star.style.cursor = "pointer";
    star.style.fontSize = "22px";
    star.style.color = "maroon";


    star.addEventListener('click', () => {
    item.rating = i;
    saveHall(currentHall, data);
    renderList();
    });

    starContainer.appendChild(star);
}


li.appendChild(starContainer);
list.appendChild(li);
});
}

  //BUTTONS
  buttons.forEach((button) => {
    button.addEventListener("click", () => {
      currentHall = button.id;
      modalTitle.textContent = `Rating ${button.textContent}`;
      pop.classList.add("open");
      renderList();
    });
  });


  closeBtn.addEventListener("click", () => {
    pop.classList.remove("open");
  });
  
  add.addEventListener('click', (event) => {
    const name = menu.value.trim();
    if (!name) return;
    const data = loadHall(currentHall);
    data.push({ name: name, rating: 0 });

    saveHall(currentHall, data);

    menu.value = '';
    renderList();
  });
})();


//MAP [DONT EDIT]
 const img = document.getElementById('map');
 const vp = document.getElementById('viewport');
 let scale = 1;
 let minScale = 0.2;
 let maxScale = 6;
 let translate = { x: 0, y: 0 };
 let isDragging = false;
 let dragStart = { x: 0, y: 0 };
 let translateStart = { x: 0, y: 0 };


 function fitToView() {
   const iw = img.naturalWidth;
   const ih = img.naturalHeight;
   const vw = vp.clientWidth;
   const vh = vp.clientHeight;
   const s = Math.min(vw/iw, vh/ih);
   scale = s;
   // center image
   const dispW = iw * scale, dispH = ih * scale;
   translate.x = Math.max(0, (vw - dispW) / 2);
   translate.y = Math.max(0, (vh - dispH) / 2);
   clampTranslate();
 }


 function update() {
   img.style.transform = `translate(${translate.x}px, ${translate.y}px) scale(${scale})`;
 }
 img.addEventListener('load', ()=>{
   fitToView();
   update();
 });


 function clampTranslate() {
   const iw = img.naturalWidth * scale;
   const ih = img.naturalHeight * scale;
   const bw = vp.clientWidth;
   const bh = vp.clientHeight;


   if (iw <= bw) { // cant go past edges
     translate.x = (bw - iw) / 2;
   } else {
     const minX = bw - iw;
     translate.x = Math.min(0, Math.max(minX, translate.x));
   }


   if (ih <= bh) {
     translate.y = (bh - ih) / 2;
   } else {
     const minY = bh - ih;
     translate.y = Math.min(0,Math.max(minY, translate.y));
   }
 }


// dragging controls
 vp.addEventListener('mousedown', (e)=>{
   isDragging = true;
   vp.style.cursor = 'grabbing';
   img.classList.add('dragging');
   dragStart = { x: e.clientX, y: e.clientY };
   translateStart = { ...translate };
 });
 window.addEventListener('mousemove', (e)=>{
   if (!isDragging) return;
   const dx = e.clientX - dragStart.x;
   const dy = e.clientY - dragStart.y;
   translate.x = translateStart.x + dx;
   translate.y = translateStart.y + dy;
   clampTranslate();
   update();
 });
 window.addEventListener('mouseup', ()=>{
   isDragging = false;
   vp.style.cursor = 'default';
   img.classList.remove('dragging');
 });


 // towards cursor -> MOUSE WHEEL
 vp.addEventListener('wheel', (e)=>{
   e.preventDefault();
   const delta = -e.deltaY;
   const zoomFactor = delta > 0?1.08:1/1.08;
   const rect = vp.getBoundingClientRect();
   const cx = e.clientX - rect.left;
   const cy = e.clientY - rect.top;


   zoomAt(zoomFactor, cx, cy);
 }, { passive: false }); // zooms the whole screen if true


 function zoomAt(factor, cx, cy) { //zooming
   const newScale = Math.max(minScale, Math.min(maxScale, scale * factor));
   const x = (cx - translate.x) / scale; // image transformations
   const y = (cy - translate.y) / scale;
  
   translate.x = cx - x * newScale; // matches scale
   translate.y = cy - y * newScale;
   scale = newScale;


   clampTranslate();
   update();
 }


})();
</script>
</body>
</html>